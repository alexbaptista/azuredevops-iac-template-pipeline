parameters:
- name: envConfig
  type: object
  default: false
- name: terraformConfig
  type: object
  default: false

steps:
  # - bash: echo "##vso[task.setvariable variable=PRTargetBranch]$(System.PullRequest.TargetBranch)"
  #   name: envPRExport
  # - bash: echo $(envPRExport.PRTargetBranch)
  #   name: testPrint
  # - ${{ if eq(variables['PRTargetBranch'], parameters.envConfig['DEV'].gitBranch) }}:
  #   - bash: |
  #       echo "##vso[task.setvariable variable=terraformPlanFilePR;isOutput=true]${{ parameters.terraformConfig['DEV'].terraformPlanFile }}"
  #       echo "##vso[task.setvariable variable=terraformWorkspaceEnvPR;isOutput=true]${{ parameters.terraformConfig['DEV'].terraformWorkspaceEnv }}"
  #     name: envConfigTargetPR
  # - ${{ if eq(variables['PRTargetBranch'], parameters.envConfig['QA'].gitBranch) }}:
  #   - bash: |
  #       echo "##vso[task.setvariable variable=terraformPlanFilePR;isOutput=true]${{ parameters.terraformConfig['QA'].terraformPlanFile }}"
  #       echo "##vso[task.setvariable variable=terraformWorkspaceEnvPR;isOutput=true]${{ parameters.terraformConfig['QA'].terraformWorkspaceEnv }}"
  #     name: envConfigTargetPR
  # - ${{ if eq(variables['PRTargetBranch'], parameters.envConfig['UAT'].gitBranch) }}:
  #   - bash: |
  #       echo "##vso[task.setvariable variable=terraformPlanFilePR;isOutput=true]${{ parameters.terraformConfig['UAT'].terraformPlanFile }}"
  #       echo "##vso[task.setvariable variable=terraformWorkspaceEnvPR;isOutput=true]${{ parameters.terraformConfig['UAT'].terraformWorkspaceEnv }}"
  #     name: envConfigTargetPR
  # - ${{ if eq(variables['PRTargetBranch'], parameters.envConfig['PRD'].gitBranch) }}:
  #   - bash: |
  #       echo "##vso[task.setvariable variable=terraformPlanFilePR;isOutput=true]${{ parameters.terraformConfig['PRD'].terraformPlanFile }}"
  #       echo "##vso[task.setvariable variable=terraformWorkspaceEnvPR;isOutput=true]${{ parameters.terraformConfig['PRD'].terraformWorkspaceEnv }}"
  #     name: envConfigTargetPR 
  - bash: |
      if [[ $(System.PullRequest.TargetBranch) = *${{ parameters.envConfig['DEV'].gitBranch }}* ]]; then

        # TF_PLAN_FILE=${{ parameters.terraformConfig['DEV'].terraformPlanFile }}
        # TF_WORKSPACE_ENV=${{ parameters.terraformConfig['DEV'].terraformWorkspaceEnv }}

        echo "##vso[task.setvariable variable=TF_PLAN_FILE]${{ parameters.terraformConfig['DEV'].terraformPlanFile }}"
        echo "##vso[task.setvariable variable=TF_WORKSPACE_ENV]${{ parameters.terraformConfig['DEV'].terraformWorkspaceEnv }}"
        echo "DEV"

      elif [[ $(System.PullRequest.TargetBranch) = *${{ parameters.envConfig['QA'].gitBranch }}* ]]; then

        # TF_PLAN_FILE=${{ parameters.terraformConfig['QA'].terraformPlanFile }}
        # TF_WORKSPACE_ENV=${{ parameters.terraformConfig['QA'].terraformWorkspaceEnv }}

        echo "##vso[task.setvariable variable=TF_PLAN_FILE]${{ parameters.terraformConfig['QA'].terraformPlanFile }}"
        echo "##vso[task.setvariable variable=TF_WORKSPACE_ENV]${{ parameters.terraformConfig['QA'].terraformWorkspaceEnv }}"
        echo "DEV"

      elif [[ $(System.PullRequest.TargetBranch) = *${{ parameters.envConfig['UAT'].gitBranch }}* ]]; then

        # TF_PLAN_FILE=${{ parameters.terraformConfig['UAT'].terraformPlanFile }}
        # TF_WORKSPACE_ENV=${{ parameters.terraformConfig['UAT'].terraformWorkspaceEnv }}

        echo "##vso[task.setvariable variable=TF_PLAN_FILE]${{ parameters.terraformConfig['UAT'].terraformPlanFile }}"
        echo "##vso[task.setvariable variable=TF_WORKSPACE_ENV]${{ parameters.terraformConfig['UAT'].terraformWorkspaceEnv }}"
        echo "DEV"

      elif [[ $(System.PullRequest.TargetBranch) = *${{ parameters.envConfig['PRD'].gitBranch }}* ]]; then

        # TF_PLAN_FILE=${{ parameters.terraformConfig['PRD'].terraformPlanFile }}
        # TF_WORKSPACE_ENV=${{ parameters.terraformConfig['PRD'].terraformWorkspaceEnv }}

        echo "##vso[task.setvariable variable=TF_PLAN_FILE]${{ parameters.terraformConfig['PRD'].terraformPlanFile }}"
        echo "##vso[task.setvariable variable=TF_WORKSPACE_ENV]${{ parameters.terraformConfig['PRD'].terraformWorkspaceEnv }}"
        echo "DEV"

      fi

      echo "##vso[task.setvariable variable=TF_PLAN_FILE]${{ parameters.terraformConfig['DEV'].terraformPlanFile }}"
      echo "##vso[task.setvariable variable=TF_WORKSPACE_ENV]${{ parameters.terraformConfig['DEV'].terraformWorkspaceEnv }}"
      
      echo $(System.PullRequest.TargetBranch)
      echo ${{ parameters.envConfig['DEV'].gitBranch }}
      
      echo ${{ variables['TF_PLAN_FILE'] }}
      echo ${{ variables['TF_WORKSPACE_ENV'] }}
      
    name: DefineVarsForPR
    displayName: "Define variables for PR"

