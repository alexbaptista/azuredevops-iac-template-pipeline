parameters:
- name: envConfig
  type: object
  default: false
- name: terraformConfig
  type: object
  default: false

steps:
  - bash: |
      set -xT
      if [[ "$(System.PullRequest.TargetBranch)" == *"${{ parameters.envConfig['DEV'].gitBranch }}"* ]];
      then
        echo "##vso[task.setvariable variable=TF_PLAN_FILE]${{ parameters.terraformConfig['DEV'].terraformPlanFile }}"
        echo "##vso[task.setvariable variable=TF_WORKSPACE_ENV]${{ parameters.terraformConfig['DEV'].terraformWorkspaceEnv }}"
        echo "DEV"
      elif [[ "$(System.PullRequest.TargetBranch)" == *"${{ parameters.envConfig['QA'].gitBranch }}"* ]];
      then
        echo "##vso[task.setvariable variable=TF_PLAN_FILE]${{ parameters.terraformConfig['QA'].terraformPlanFile }}"
        echo "##vso[task.setvariable variable=TF_WORKSPACE_ENV]${{ parameters.terraformConfig['QA'].terraformWorkspaceEnv }}"
        echo "QA"
      elif [[ "$(System.PullRequest.TargetBranch)" == *"${{ parameters.envConfig['UAT'].gitBranch }}"* ]];
      then
        echo "##vso[task.setvariable variable=TF_PLAN_FILE]${{ parameters.terraformConfig['UAT'].terraformPlanFile }}"
        echo "##vso[task.setvariable variable=TF_WORKSPACE_ENV]${{ parameters.terraformConfig['UAT'].terraformWorkspaceEnv }}"
        echo "UAT"
      elif [[ "$(System.PullRequest.TargetBranch)" == *"${{ parameters.envConfig['PRD'].gitBranch }}"* ]];
      then
        echo "##vso[task.setvariable variable=TF_PLAN_FILE]${{ parameters.terraformConfig['PRD'].terraformPlanFile }}"
        echo "##vso[task.setvariable variable=TF_WORKSPACE_ENV]${{ parameters.terraformConfig['PRD'].terraformWorkspaceEnv }}"
        echo "PRD"
      fi
    name: DefineVarsForPR
    displayName: "Define variables for PR"
  - bash: |
      echo $TF_PLAN_FILE
      echo $TF_WORKSPACE_ENV
    name: PrintVars
    displayName: "Print vars"

