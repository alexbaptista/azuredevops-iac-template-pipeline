parameters:
- name: envConfig
  type: object
  default: false
- name: terraformConfig
  type: object
  default: false

steps:
  - bash: echo "##vso[task.setvariable variable=PRTargetBranch;isOutput=true]$(System.PullRequest.TargetBranch)"
    name: envPRExport
  - bash: echo $(envPRExport.PRTargetBranch)
    name: testPrint
  - ${{ if eq(variables['PRTargetBranch'], parameters.envConfig['DEV'].gitBranch) }}:
    - bash: |
        echo "##vso[task.setvariable variable=terraformPlanFilePR;isOutput=true]${{ parameters.terraformConfig['DEV'].terraformPlanFile }}"
        echo "##vso[task.setvariable variable=terraformWorkspaceEnvPR;isOutput=true]${{ parameters.terraformConfig['DEV'].terraformWorkspaceEnv }}"
      name: envConfigTargetPR
  - ${{ if eq(variables['PRTargetBranch'], parameters.envConfig['QA'].gitBranch) }}:
    - bash: |
        echo "##vso[task.setvariable variable=terraformPlanFilePR;isOutput=true]${{ parameters.terraformConfig['QA'].terraformPlanFile }}"
        echo "##vso[task.setvariable variable=terraformWorkspaceEnvPR;isOutput=true]${{ parameters.terraformConfig['QA'].terraformWorkspaceEnv }}"
      name: envConfigTargetPR
  - ${{ if eq(variables['PRTargetBranch'], parameters.envConfig['UAT'].gitBranch) }}:
    - bash: |
        echo "##vso[task.setvariable variable=terraformPlanFilePR;isOutput=true]${{ parameters.terraformConfig['UAT'].terraformPlanFile }}"
        echo "##vso[task.setvariable variable=terraformWorkspaceEnvPR;isOutput=true]${{ parameters.terraformConfig['UAT'].terraformWorkspaceEnv }}"
      name: envConfigTargetPR
  - ${{ if eq(variables['PRTargetBranch'], parameters.envConfig['PRD'].gitBranch) }}:
    - bash: |
        echo "##vso[task.setvariable variable=terraformPlanFilePR;isOutput=true]${{ parameters.terraformConfig['PRD'].terraformPlanFile }}"
        echo "##vso[task.setvariable variable=terraformWorkspaceEnvPR;isOutput=true]${{ parameters.terraformConfig['PRD'].terraformWorkspaceEnv }}"
      name: envConfigTargetPR
