parameters:
  - name: terraformPath
    type: string
    default: false

steps:
  - bash: |
      terraform show $TF_PLAN_FILE > terraform.txt
      # TF_PLAN_TXT=$(echo -e $(cat terraform.txt))
      TF_PLAN_TXT=$(echo "$(cat terraform.txt)" | sed 's/\x1b\[[0-9;]*m//g')
      echo "##vso[task.setvariable variable=TF_PLAN_COMMENT_PR]$TF_PLAN_TXT"
    name: GetTerraformPlan
    displayName: "Get Terraform Plan"
    workingDirectory: ${{ parameters.terraformPath }}